from ...arc.base import *
from ...arc.graphic import *
from ...arc.ml import *
from ...arc.global_attention import *


def test_361():
    x_grids = [x361_0, x361_1, x361_2]
    all_x_shapes = [list_objects(grid.remove_bg()) for grid in x_grids]
    attentions = make_attentions(all_x_shapes, x_grids)
    assert len(attentions) == 2
    atn = attentions[1]
    for id1, id2 in zip(atn.query_sample_index, atn.query_shape_index):
        shape = all_x_shapes[id1][id2]
        assert shape.top_color == 5

    model = ColumnModel('top_color_5')
    atn2 = to_runtimes(GlobalAttentionModel(model), all_x_shapes, x_grids)
    for id1, id2 in zip(atn2.query_sample_index, atn2.query_shape_index):
        shape = all_x_shapes[id1][id2]
        assert shape.top_color == 5


x361_0 = Grid([
    [0, 0, 0, 2, 0, 0, 0, 0, 0, 5],
    [0, 0, 0, 2, 0, 0, 0, 0, 0, 5],
    [0, 0, 0, 2, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 2, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 2, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 2, 0, 0, 0, 0, 0, 0],
    [2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
    [0, 0, 0, 2, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 2, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 2, 0, 0, 0, 0, 0, 0]
])

x361_1 = Grid([
    [0, 0, 0, 4, 0, 0, 0, 0, 0, 5],
    [0, 0, 0, 4, 0, 0, 0, 0, 0, 5],
    [0, 0, 0, 4, 0, 0, 0, 0, 0, 5],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [0, 0, 0, 4, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 4, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 4, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 4, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 4, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 4, 0, 0, 0, 0, 0, 0]
])

x361_2 = Grid([
    [0, 0, 0, 0, 0, 0, 6, 0, 0, 5],
    [0, 0, 0, 0, 0, 0, 6, 0, 0, 5],
    [0, 0, 0, 0, 0, 0, 6, 0, 0, 5],
    [0, 0, 0, 0, 0, 0, 6, 0, 0, 0],
    [6, 6, 6, 6, 6, 6, 6, 6, 6, 6],
    [0, 0, 0, 0, 0, 0, 6, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 6, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 6, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 6, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 6, 0, 0, 0]
])

x142_0 = Grid([
    [1, 1, 0, 5, 0, 0, 0, 7, 0, 0],
    [0, 1, 1, 5, 0, 0, 7, 7, 7, 0],
    [0, 0, 1, 5, 0, 0, 0, 7, 0, 0],
    [5, 5, 5, 5, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 6, 6, 0, 0, 0],
    [7, 7, 7, 0, 0, 0, 6, 6, 0, 0],
    [0, 0, 7, 0, 0, 0, 0, 6, 0, 0],
    [0, 0, 0, 0, 8, 0, 0, 0, 0, 0],
    [0, 0, 0, 8, 8, 8, 8, 0, 0, 0]
])

x142_1 = Grid([
    [0, 3, 0, 5, 0, 0, 0, 0, 0, 0],
    [3, 3, 0, 5, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 5, 0, 0, 4, 4, 0, 0],
    [5, 5, 5, 5, 0, 0, 4, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 7, 7, 7, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 9, 0],
    [8, 8, 0, 0, 0, 0, 0, 9, 9, 0],
    [8, 8, 0, 0, 0, 0, 0, 0, 0, 0]
])

x142_2 = Grid([
    [0, 4, 0, 5, 0, 0, 0, 1, 0, 0],
    [4, 4, 4, 5, 0, 0, 1, 1, 1, 0],
    [0, 0, 0, 5, 0, 0, 0, 0, 0, 0],
    [5, 5, 5, 5, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 3, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 3, 3, 0, 0],
    [0, 0, 0, 0, 0, 0, 3, 0, 0, 0],
    [0, 6, 6, 6, 0, 0, 0, 0, 0, 0],
    [0, 0, 6, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
])
